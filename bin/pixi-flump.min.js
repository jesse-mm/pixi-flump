!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(e.PIXI||(e.PIXI={})).FlumpLibrary=t()}}(function(){return function t(e,r,i){function n(s,a){if(!r[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var h=r[s]={exports:{}};e[s][0].call(h.exports,function(t){var r=e[s][1][t];return n(r?r:t)},h,h.exports,t,e,r,i)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(t,e,r){"use strict";var i=t("./util/Promise"),n=t("./util/HttpRequest"),o=t("./util/PromiseUtil"),s=t("./core/TextureGroup"),a=t("./core/FlumpMovie"),u=t("./data/MovieData"),l=t("./util/QueueItem"),h=function(){function t(t){this.movieData=[],this.textureGroups=[],this.fps=0,this.isOptimised=!1,this._hasLoaded=!1,this._isLoading=!1;t&&(this.url=t)}return t.load=function(e,r,i){var o=e;return e.indexOf(".json")>-1?o=e.substr(0,e.lastIndexOf("/")):("/"==o.substr(-1)&&(o=o.substr(0,o.length-1)),e+=("/"!=e.substr(e.length-1)?"/":"")+"library.json"),void 0==r?r=new t(o):r.url=o,n.HttpRequest.getJSON(e).then(function(t){return r.processData(t,i)})},t.prototype.hasLoaded=function(){return this._hasLoaded},t.prototype.isLoading=function(){return this._isLoading},t.prototype.load=function(e){if(this.hasLoaded())return e(1),i.Promise.resolve(this);if(!this.url)throw new Error("url is not set and there for can not be loaded");return t.load(this.url,this,e)["catch"](function(){throw new Error("could not load library")})},t.prototype.processData=function(t,e){var r=this;this.md5=t.md5,this.frameRate=t.frameRate,this.referenceList=t.referenceList||null,this.isOptimised=t.optimised||!1;for(var i=[],n=0;n<t.movies.length;n++){var a=new u.MovieData(this,t.movies[n]);this.movieData.push(a)}for(var l=t.textureGroups,n=0;n<l.length;n++){var h=l[n],f=s.TextureGroup.load(this,h);i.push(f)}return o.PromiseUtil.wait(i,e).then(function(t){for(var e=0;e<t.length;e++){var i=t[e];r.textureGroups.push(i)}return r._hasLoaded=!0,r})},t.prototype.getMovieData=function(t){for(var e=0;e<this.movieData.length;e++){var r=this.movieData[e];if(r.id==t)return r}throw new Error("movie not found")},t.prototype.createSymbol=function(t,e){void 0===e&&(e=!1);for(var r=0;r<this.textureGroups.length;r++){var i=this.textureGroups[r].sprites;if(t in i)return i[t]}for(var r=0;r<this.movieData.length;r++){var n=this.movieData[r];if(n.id==t){var o=new a.FlumpMovie(this,t);return o.getQueue().add(new l.QueueItem(null,0,o.frames,-1,0)),o.paused=e,o}}throw console.warn("no _symbol found: ("+t+")"),new Error("no _symbol found")},t.prototype.createMovie=function(t){var e;e=t;for(var r=0;r<this.movieData.length;r++){var i=this.movieData[r];if(i.id==e){var n=new a.FlumpMovie(this,e);return n.paused=!0,n}}throw console.warn("no _symbol found: ("+e+") ",this),new Error("no _symbol found: "+this)},t.prototype.getNameFromReferenceList=function(t){return this.referenceList&&"number"==typeof t?this.referenceList[t]:t},t.EVENT_LOAD="load",t}();r.FlumpLibrary=h},{"./core/FlumpMovie":2,"./core/TextureGroup":5,"./data/MovieData":10,"./util/HttpRequest":13,"./util/Promise":14,"./util/PromiseUtil":15,"./util/QueueItem":17}],2:[function(t,e,r){"use strict";var i=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},n=t("../util/AnimationQueue"),o=t("../util/QueueItem"),s=t("../core/MovieLayer"),a=function(t){function e(e,r){t.call(this),this._labels={},this._queue=null,this.hasFrameCallbacks=!1,this.paused=!0,this.frame=0,this.frames=0,this.speed=1,this.fps=1,this.name=r,this._library=e,this._movieData=e.getMovieData(r);for(var i=this._movieData.layerData,n=i.length,o=new Array(n),a=0;n>a;a++){var u=i[a];o[a]=new s.MovieLayer(a,this,e,u),this.addChild(o[a])}this._movieLayers=o,this.frames=this._movieData.frames,this._frameCallback=new Array(this.frames);for(var a=0;a<this.frames;a++)this._frameCallback[a]=null;this.fps=e.frameRate,this.getQueue()}return i(e,t),e.prototype.setLabel=function(t,e){this._labels[t]=e},e.prototype.getQueue=function(){return this._queue||(this._queue=new n.AnimationQueue(this.fps,1e3)),this._queue},e.prototype.play=function(t,e,r){if(void 0===t&&(t=1),void 0===e&&(e=null),this.visible=!0,e instanceof Array)if(1==e.length)var i=new o.QueueItem(null,e[0],this.frames,t,0);else var i=new o.QueueItem(null,e[0],e[1],t,0);else if(null==e||"*"==e)var i=new o.QueueItem(null,0,this.frames,t,0);else{var n=this._labels[e];if(!n)throw new Error("unknown label:"+n+" | "+this.name);var i=new o.QueueItem(n.label,n.index,n.duration,t,0)}return r&&i.then(r),this._queue.add(i),r&&i.then(r),this.paused=!1,this},e.prototype.resume=function(){return this.paused=!1,this},e.prototype.pause=function(){return this.paused=!0,this},e.prototype.end=function(t){return void 0===t&&(t=!1),this._queue.end(t),this},e.prototype.stop=function(){return this.paused=!0,this._queue.kill(),this},e.prototype.next=function(){return this._queue.next()},e.prototype.kill=function(){return this._queue.kill(),this},e.prototype.setFrameCallback=function(t,e,r){var i=this;return void 0===r&&(r=!1),this.hasFrameCallbacks=!0,r?this._frameCallback[t]=function(r){e.call(i,r),i.setFrameCallback(t,null)}:this._frameCallback[t]=e,this},e.prototype.gotoAndStop=function(t){var e;e="string"==typeof t?this._labels[t].index:t;var r=new o.QueueItem(null,e,1,1,0);return this._queue.add(r),this},e.prototype.onTick=function(t,e){var r=this._movieLayers;if(t*=this.speed,0==this.paused){this._queue.onTick(t);for(var i=(this.frame,this._queue.getFrame()),n=0;n<r.length;n++){var o=r[n];o.onTick(t,e),o.setFrame(i)}this.frame=i}},e.prototype.getSymbol=function(t){for(var e=this._movieLayers,r=0;r<e.length;r++){var i=e[r],n=i.getSymbol(t);if(null!=n)return n}return null},e.prototype.replaceSymbol=function(t,e){for(var r=this._movieLayers,i=0;i<r.length;i++){var n=r[i];if(n.replaceSymbol(t,e))return!0}return!1},e.prototype.handleFrameCallback=function(t,e,r){if(e>t)for(var i=t;e>i;i++)this._frameCallback[i]&&this._frameCallback[i].call(this,r);else if(t>e){for(var i=t;i<this.frames;i++)this._frameCallback[i]&&this._frameCallback[i].call(this,r);for(var i=0;e>i;i++)this._frameCallback[i]&&this._frameCallback[i].call(this,r)}return this},e.prototype.reset=function(){for(var t=this._movieLayers,e=0;e<t.length;e++){var r=t[e];r.reset()}},e}(PIXI.Container);r.FlumpMovie=a},{"../core/MovieLayer":4,"../util/AnimationQueue":12,"../util/QueueItem":17}],3:[function(t,e,r){"use strict";var i=function(){function t(t,e,r,i,n,o){this.a=t,this.b=e,this.c=r,this.d=i,this.tx=n,this.ty=o}return t}();r.FlumpMtx=i},{}],4:[function(t,e,r){"use strict";var i=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},n=t("./FlumpMtx"),o=t("./FlumpMovie"),s=t("../data/LabelData"),a=t("../data/KeyframeData"),u=function(t){function e(e,r,i,o){t.call(this),this.name="",this._frame=0,this._symbols={},this.enabled=!0,this._storedMtx=new n.FlumpMtx(1,0,0,1,0,0);var a=o.keyframeData;this._index=e,this._movie=r,this._layerData=o,this.name=o.name;for(var u=0;u<a.length;u++){var l=a[u];l.label&&r.setLabel(l.label,new s.LabelData(l.label,l.index,l.duration)),-1!=l.ref&&null!=l.ref&&l.ref in this._symbols==0&&(this._symbols[l.ref]=i.createSymbol(l.ref,!1))}this.setFrame(0)}return i(e,t),e.prototype.getSymbol=function(t){var e=this._symbols;for(var r in e){var i=e[r];if(i instanceof o.FlumpMovie){if(i.name==t)return i;var n=i.getSymbol(t);if(null!=n)return n}}return null},e.prototype.replaceSymbol=function(t,e){var r=this._symbols;for(var i in r){var n=r[i];if(n.name==t)return this._symbols[i]=e,!0;if(n instanceof o.FlumpMovie&&n.replaceSymbol(t,e))return!0}return!1},e.prototype.onTick=function(t,e){null!=this._symbol&&this._symbol instanceof o.FlumpMovie&&this._symbol.onTick(t,e)},e.prototype.setFrame=function(t){var e=this._layerData.getKeyframeForFrame(Math.floor(t));return-1!=e.ref&&null!=e.ref?(this._symbol!=this._symbols[e.ref]&&(this.removeChildren(),this._symbol=this._symbols[e.ref],this._symbol instanceof o.FlumpMovie&&this._symbol.reset(),this.addChild(this._symbol)),this.setKeyframeData(this._symbol,e,t)):(this.removeChildren(),this._symbol=null),!0},e.prototype.setKeyframeData=function(t,e,r){var i,n,o,s=e.x,u=e.y,l=e.scaleX,h=e.scaleY,f=e.skewX,c=e.skewY,p=e.pivotX,m=e.pivotY,v=e.alpha;if(e.index<r&&e.tweened&&(o=this._layerData.getKeyframeAfter(e),o instanceof a.KeyframeData)){if(n=(r-e.index)/e.duration,i=e.ease,0!=i){var y=0;if(0>i){var d=1-n;y=1-d*d,i=0-i}else y=n*n;n=i*y+(1-i)*n}s+=(o.x-s)*n,u+=(o.y-u)*n,l+=(o.scaleX-l)*n,h+=(o.scaleY-h)*n,f+=(o.skewX-f)*n,c+=(o.skewY-c)*n,v+=(o.alpha-v)*n}t.setTransform(s,u,l,h,0,f,c,p,m),t.visible=e.visible,t.alpha=v,this._frame=r},e.prototype.reset=function(){this._symbol instanceof o.FlumpMovie&&this._symbol.reset();for(var t in this._symbols){var e=this._symbols[t];e instanceof o.FlumpMovie&&e.reset()}},e}(PIXI.Container);r.MovieLayer=u},{"../data/KeyframeData":7,"../data/LabelData":8,"./FlumpMovie":2,"./FlumpMtx":3}],5:[function(t,e,r){"use strict";var i=t("./TextureGroupAtlas"),n=t("../util/Promise"),o=function(){function t(t){this.sprites={};for(var e=0;e<t.length;e++){var r=t[e];this.sprites[r.name]=r}}return t.load=function(e,r){for(var o=r.atlases,s=[],a=0;a<o.length;a++){var u=o[a];s.push(i.TextureGroupAtlas.load(e,u))}return n.Promise.all(s).then(function(e){for(var r=[],i=0;i<e.length;i++){var n=e[i];r=r.concat(n.getSprites())}return new t(r)})["catch"](function(t){throw console.warn("could not load textureGroup",t),new Error("could not load textureGroup")})},t}();r.TextureGroup=o},{"../util/Promise":14,"./TextureGroupAtlas":6}],6:[function(t,e,r){"use strict";var i=t("../util/Promise"),n=PIXI.Texture,o=PIXI.BaseTexture,s=PIXI.Rectangle,a=function(){function t(t,e){this._renderTexture=new o(t),this._atlas=e}return t.load=function(e,r){var n=r.file,o=e.url+"/"+n;return new i.Promise(function(t,e){var r=document.createElement("img");r.onload=function(){t(r)},r.onerror=function(){e()},r.src=o}).then(function(e){return new t(e,r)})},t.prototype.getSprites=function(){for(var t=[],e=this._atlas.textures,r=this._renderTexture,i=0;i<e.length;i++){var o=e[i],a=new PIXI.Sprite(new n(r,new s(o.rect[0],o.rect[1],o.rect[2],o.rect[3])));a.name=o.symbol,t.push(a)}return t},t}();r.TextureGroupAtlas=a},{"../util/Promise":14}],7:[function(t,e,r){"use strict";var i=function(){function t(t){if(void 0!=t.length)this.fromArray(t);else{var e=t;this.index=e.index,this.duration=e.duration,this.ref="ref"in e?e.ref:null,this.label="label"in e?e.label:null,this.x="loc"in e?e.loc[0]:0,this.y="loc"in e?e.loc[1]:0,this.scaleX="scale"in e?e.scale[0]:1,this.scaleY="scale"in e?e.scale[1]:1,this.skewX="skew"in e?e.skew[0]:0,this.skewY="skew"in e?e.skew[1]:0,this.pivotX="pivot"in e?e.pivot[0]:0,this.pivotY="pivot"in e?e.pivot[1]:0,this.visible="visible"in e?e.visible:!0,this.alpha="alpha"in e?e.alpha:1,this.tweened="tweened"in e?e.tweened:!0,this.ease="ease"in e?e.ease:0}}return t.prototype.getValueOrder=function(){return["index","duration","ref","label","x","y","scaleX","scaleY","skewX","skewY","pivotX","pivotY","visible","alpha","tweened","ease"]},t.prototype.toArray=function(){for(var t=this.getValueOrder(),e=new Array(t.length),r=0;r<t.length;r++){var i=t[r];e[r]=this[i]}return e},t.prototype.fromArray=function(t){for(var e=this.getValueOrder(),r=0;r<t.length;r++){var i=e[r],n=t[r];this[i]=n}},t}();r.KeyframeData=i},{}],8:[function(t,e,r){"use strict";var i=function(){function t(t,e,r){this.label=t,this.index=e,this.duration=r}return t}();r.LabelData=i},{}],9:[function(t,e,r){"use strict";var i=t("./KeyframeData"),n=function(){function t(t){this.keyframeData=[],this.name=t.name,this.flipbook="flipbook"in t?!!t.flipbook:!1;for(var e=t.keyframes,r=null,n=0;n<e.length;n++){var o=e[n];r=new i.KeyframeData(o),this.keyframeData.push(r)}this.frames=r.index+r.duration}return t.prototype.getKeyframeForFrame=function(t){for(var e=this.keyframeData,r=1;r<e.length;r++)if(e[r].index>t)return e[r-1];return e[e.length-1]},t.prototype.getKeyframeAfter=function(t){for(var e=0;e<this.keyframeData.length-1;e++)if(this.keyframeData[e]===t)return this.keyframeData[e+1];return null},t}();r.LayerData=n},{"./KeyframeData":7}],10:[function(t,e,r){"use strict";var i=t("./LayerData"),n=function(){function t(t,e){this.frames=0;var r=e.layers;this.id=e.id,this.layerData=new Array(r.length);for(var n=0;n<r.length;n++){var o=this.layerData[n]=new i.LayerData(r[n]);this.frames=Math.max(this.frames,o.frames)}}return t}();r.MovieData=n},{"./LayerData":9}],11:[function(t,e,r){"use strict";var i=t("./FlumpLibrary");e.exports=i.FlumpLibrary},{"./FlumpLibrary":1}],12:[function(t,e,r){"use strict";var i=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},n=t("./Queue"),o=function(t){function e(e,r){void 0===r&&(r=1e3),t.call(this),this.frame=0,this._freeze=!1,this._hasStopped=!1,this._time=0,this._fpms=0,this._fpms=r/e}return i(e,t),e.prototype.onTick=function(t){var e=this._time+=t;if(null!=this.current||null!=this.next()){var r=this.current,i=r.from,n=r.duration,o=r.times,s=n*e/(n*this._fpms);o>-1&&0>o-s/n?this.next():this.frame=i+s%n}},e.prototype.hasStopped=function(){return!this.current&&!this.hasNext()},e.prototype.next=function(){var e=t.prototype.next.call(this);return e&&this.reset(),e},e.prototype.getFrame=function(){return this.frame},e.prototype.reset=function(){this._freeze=!1,this._time=this._time%this._fpms},e}(n.Queue);r.AnimationQueue=o},{"./Queue":16}],13:[function(t,e,r){"use strict";var i=t("../util/Promise"),n=function(){function t(){}return t.request=function(t,e,r){var n=new i.Promise(function(i,n){var o=new XMLHttpRequest,s=e;if(r&&("POST"===t||"PUT"===t)){s+="?";var a=0;for(var u in r)r.hasOwnProperty(u)&&(a++&&(s+="&"),s+=encodeURIComponent(u)+"="+encodeURIComponent(r[u]))}o.open(t,s),o.send(),o.onload=function(){200===this.status||0===this.status?i(this.response||this.responseText):n(this.statusText)},o.onerror=function(){n(this.statusText)}});return n},t.getString=function(e,r){return void 0===r&&(r={}),t.request("GET",e,r)},t.getJSON=function(e,r){return void 0===r&&(r={}),t.getString(e,r).then(function(t){return JSON.parse(t)})},t}();r.HttpRequest=n},{"../util/Promise":14}],14:[function(t,e,r){"use strict";function i(t){var e=this;return null===this._state?void this._deferreds.push(t):void l(function(){var r=e._state?t.onFulfilled:t.onRejected;if(null===r)return void(e._state?t.resolve:t.reject)(e._value);var i;try{i=r(e._value)}catch(n){return void t.reject(n)}t.resolve(i)})}function n(t){try{if(t===this)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var e=t.then;if("function"==typeof e)return void u(e.bind(t),n.bind(this),o.bind(this))}this._state=!0,this._value=t,s.call(this)}catch(r){o.call(this,r)}}function o(t){this._state=!1,this._value=t,s.call(this)}function s(){for(var t=0,e=this._deferreds.length;e>t;t++)i.call(this,this._deferreds[t]);this._deferreds=null}function a(t,e,r,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=r,this.reject=i}function u(t,e,r){var i=!1;try{t(function(t){i||(i=!0,e(t))},function(t){i||(i=!0,r(t))})}catch(n){if(i)return;i=!0,r(n)}}var l="function"==typeof setImmediate&&setImmediate||function(t){setTimeout(t,1)};Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),r=this,i=function(){},n=function(){return r.apply(this instanceof i?this:t,e.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(i.prototype=this.prototype),n.prototype=new i,n});var h=(Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},function(){function t(t){if(this._state=null,this._value=null,this._deferreds=[],"object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");u(t,n.bind(this),o.bind(this))}return t.all=function(e){return new t(function(t,r){function i(o,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,function(t){i(o,t)},r)}e[o]=s,0===--n&&t(e)}catch(u){r(u)}}if(0===e.length)return t([]);for(var n=e.length,o=0;o<e.length;o++)i(o,e[o])})},t.resolve=function(e){return e&&"object"==typeof e&&e.constructor===t?e:new t(function(t){t(e)})},t.reject=function(e){return new t(function(t,r){r(e)})},t.race=function(e){return new t(function(t,r){for(var i=0,n=e.length;n>i;i++)e[i].then(t,r)})},t._setImmediateFn=function(t){l=t},t.prototype["catch"]=function(t){return this.then(null,t)},t.prototype.then=function(e,r){var n=this;return new t(function(t,o){i.call(n,new a(e,r,t,o))})},t}());r.Promise=h},{}],15:[function(t,e,r){"use strict";var i=t("./Promise"),n=function(){function t(){}return t.wait=function(t,e){return void 0===e&&(e=function(t){}),new i.Promise(function(r){for(var i=[],n=function(n){i.push(n),e(i.length/t.length),i.length==t.length&&r(i)},o=0;o<t.length;o++)t[o].then(n)})},t.waitForLoadable=function(e,r){void 0===r&&(r=function(t){});for(var i=e.length,n=[],o=0;i>o;o++)n.push(0);for(var s=function(t,e){n[t]=e;for(var o=0,s=n.length,a=0;s>a;a++)o+=n[a];r(o/i)},a=new Array(i),o=0;i>o;o++)a[o]=e[o].load(s.bind(this,o));return t.wait(a)},t}();r.PromiseUtil=n},{"./Promise":14}],16:[function(t,e,r){"use strict";var i=function(){function t(){this._list=[],this._listLength=0,this.current=null}return t.prototype.add=function(t){return this._list.push(t),this._listLength++,this},t.prototype.next=function(){return this.kill(),this._listLength>0?(this.current=this._list.shift(),this._listLength--):this.current=null,this.current},t.prototype.hasNext=function(){return this._listLength>0},t.prototype.end=function(t){return void 0===t&&(t=!1),t&&(this._list.length=0,this._listLength=0),this.current&&(this.current.times=1),this},t.prototype.kill=function(t){if(void 0===t&&(t=!1),t&&(this._list.length=0,this._listLength=0),this.current){var e=this.current;this.current=null,e.finish(),e.destruct()}return this},t}();r.Queue=i},{}],17:[function(t,e,r){"use strict";var i=function(){function t(t,e,r,i,n){if(void 0===i&&(i=1),void 0===n&&(n=0),this._complete=null,e>r)throw new Error('argument "from" cannot be bigger than argument "to"');this.label=t,this.from=e,this.to=r,this.duration=r-e,this.times=i,this.delay=n}return t.prototype.then=function(t){return this._complete=t,this},t.prototype.finish=function(){return this._complete&&this._complete.call(this),this},t.prototype.destruct=function(){this.label=null,this._complete=null},t}();r.QueueItem=i},{}]},{},[11])(11)});
//# sourceMappingURL=pixi-flump.min.js.map
